<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cuit.hyl.graduation.project_ui.dao.BasicInfoDao">

    <resultMap type="cuit.hyl.graduation.project_ui.entity.vo.InitInfo" id="InitInfoMap">
        <result property="id" column="ID" jdbcType="INTEGER"/>
        <result property="name" column="NAME" jdbcType="VARCHAR"/>
        <result property="nickName" column="NICK_NAME" jdbcType="VARCHAR"/>
        <result property="avatatUrl" column="AVATAT_URL" jdbcType="VARCHAR"/>
        <result property="blog" column="BLOG" jdbcType="VARCHAR"/>
        <result property="icon" column="ICON" jdbcType="VARCHAR"/>
        <result property="school" column="SCHOOL" jdbcType="VARCHAR"/>
    </resultMap>

    <resultMap type="cuit.hyl.graduation.project_ui.entity.School" id="SchoolMap">
        <result property="id" column="ID" jdbcType="INTEGER"/>
        <result property="name" column="NAME" jdbcType="VARCHAR"/>
        <result property="code" column="CODE" jdbcType="INTEGER"/>
        <result property="address" column="ADDRESS" jdbcType="VARCHAR"/>
        <result property="icon" column="ICON" jdbcType="VARCHAR"/>
    </resultMap>

    <resultMap type="cuit.hyl.graduation.project_ui.entity.BasicInfo" id="BasicInfoMap">
        <result property="id" column="ID" jdbcType="INTEGER"/>
        <result property="name" column="NAME" jdbcType="VARCHAR"/>
        <result property="nickName" column="NICK_NAME" jdbcType="VARCHAR"/>
        <result property="sex" column="SEX" jdbcType="INTEGER"/>
        <result property="birthday" column="BIRTHDAY" jdbcType="DATE"/>
        <result property="politicalStatus" column="POLITICAL_STATUS" jdbcType="VARCHAR"/>
        <result property="age" column="AGE" jdbcType="INTEGER"/>
        <result property="hometown" column="HOMETOWN" jdbcType="VARCHAR"/>
        <result property="avatatUrl" column="AVATAT_URL" jdbcType="VARCHAR"/>
        <result property="phone" column="PHONE" jdbcType="VARCHAR"/>
        <result property="fax" column="FAX" jdbcType="VARCHAR"/>
        <result property="email" column="EMAIL" jdbcType="VARCHAR"/>
        <result property="qq" column="QQ" jdbcType="VARCHAR"/>
        <result property="wechat" column="WECHAT" jdbcType="VARCHAR"/>
        <result property="blog" column="BLOG" jdbcType="VARCHAR"/>
        <result property="postCode" column="POST_CODE" jdbcType="VARCHAR"/>
        <result property="address" column="ADDRESS" jdbcType="VARCHAR"/>
        <result property="department" column="DEPARTMENT" jdbcType="VARCHAR"/>
        <result property="degree" column="DEGREE" jdbcType="VARCHAR"/>
        <result property="subject" column="SUBJECT" jdbcType="VARCHAR"/>
        <result property="position" column="POSITION" jdbcType="VARCHAR"/>
        <result property="jobTitle" column="JOB_TITLE" jdbcType="VARCHAR"/>
        <result property="introduction" column="INTRODUCTION" jdbcType="OTHER"/>
        <result property="researchAreas" column="RESEARCH_AREAS" jdbcType="OTHER"/>
        <result property="unitId" column="UNIT_ID" jdbcType="INTEGER"/>
        <result property="schoolId" column="SCHOOL_ID" jdbcType="INTEGER"/>
        <result property="peopleId" column="PEOPLE_ID" jdbcType="INTEGER"/>
    </resultMap>

    <!--通过用户id 查询-->
    <select id="queryByPeopleId" resultMap="BasicInfoMap">
        select
          ID, NAME, NICK_NAME, SEX, BIRTHDAY, POLITICAL_STATUS, AGE, HOMETOWN, AVATAT_URL, PHONE, FAX, EMAIL, QQ, WECHAT, BLOG, POST_CODE, ADDRESS, DEPARTMENT, DEGREE, SUBJECT, POSITION, JOB_TITLE, INTRODUCTION, RESEARCH_AREAS, UNIT_ID, SCHOOL_ID, PEOPLE_ID
        from graduation_ui.basic_info
        where PEOPLE_ID = #{id} AND VERSION = #{version}
        order by TIME desc
    </select>

    <!-- 初始化新增 -->
    <insert id="insertInitInfo" >
        INSERT INTO graduation_ui.basic_info
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null and '' != id">
                ID,
            </if>
            <if test="name != null and '' != name">
                NAME,
            </if>
            <if test="nickName != null and '' != nickName">
                NICK_NAME,
            </if>
            <if test="sex != null and '' != sex">
                SEX,
            </if>
            <if test="birthday != null">
                BIRTHDAY,
            </if>
            <if test="politicalStatus != null and '' != politicalStatus">
                POLITICAL_STATUS,
            </if>
            <if test="age != null and '' != age">
                AGE,
            </if>
            <if test="hometown != null and '' != hometown">
                HOMETOWN,
            </if>
            <if test="avatarUrl != null and '' != avatarUrl">
                AVATAT_URL,
            </if>
            <if test="phone != null and '' != phone">
                PHONE,
            </if>
            <if test="fax != null and '' != fax">
                FAX,
            </if>
            <if test="email != null and '' != email">
                EMAIL,
            </if>
            <if test="qq != null and '' != qq">
                QQ,
            </if>
            <if test="wechat != null and '' != wechat">
                WECHAT,
            </if>
            <if test="blog != null and '' != blog">
                BLOG,
            </if>
            <if test="postCode != null and '' != postCode">
                POST_CODE,
            </if>
            <if test="address != null and '' != address">
                ADDRESS,
            </if>
            <if test="department != null and '' != department">
                DEPARTMENT,
            </if>
            <if test="degree != null and '' != degree">
                DEGREE,
            </if>
            <if test="subject != null and '' != subject">
                SUBJECT,
            </if>
            <if test="position != null and '' != position">
                POSITION,
            </if>
            <if test="jobTitle != null and '' != jobTitle">
                JOB_TITLE,
            </if>
            <if test="introduction != null and '' != introduction">
                INTRODUCTION,
            </if>
            <if test="researchAreas != null and '' != researchAreas">
                RESEARCH_AREAS,
            </if>
            <if test="unitId != null and '' != unitId">
                UNIT_ID,
            </if>
            <if test="schoolId != null and '' != schoolId">
                SCHOOL_ID,
            </if>
            <if test="peopleId != null and '' != peopleId">
                PEOPLE_ID,
            </if>
            <if test="time != null ">
                TIME,
            </if>
            <if test="version != null and '' != version">
                VERSION,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null and '' != id">
                #{id},
            </if>
            <if test="name != null and '' != name">
                #{name},
            </if>
            <if test="nickName != null and '' != nickName">
                #{nickName},
            </if>
            <if test="sex != null and '' != sex">
                #{sex},
            </if>
            <if test="birthday != null">
                #{birthday},
            </if>
            <if test="politicalStatus != null and '' != politicalStatus">
                #{politicalStatus},
            </if>
            <if test="age != null and '' != age">
                #{age},
            </if>
            <if test="hometown != null and '' != hometown">
                #{hometown},
            </if>
            <if test="avatarUrl != null and '' != avatarUrl">
                #{avatarUrl},
            </if>
            <if test="phone != null and '' != phone">
                #{phone},
            </if>
            <if test="fax != null and '' != fax">
                #{fax},
            </if>
            <if test="email != null and '' != email">
                #{email},
            </if>
            <if test="qq != null and '' != qq">
                #{qq},
            </if>
            <if test="wechat != null and '' != wechat">
                #{wechat},
            </if>
            <if test="blog != null and '' != blog">
                #{blog},
            </if>
            <if test="postCode != null and '' != postCode">
                #{postCode},
            </if>
            <if test="address != null and '' != address">
                #{address},
            </if>
            <if test="department != null and '' != department">
                #{department},
            </if>
            <if test="degree != null and '' != degree">
                #{degree},
            </if>
            <if test="subject != null and '' != subject">
                #{subject},
            </if>
            <if test="position != null and '' != position">
                #{position},
            </if>
            <if test="jobTitle != null and '' != jobTitle">
                #{jobTitle},
            </if>
            <if test="introduction != null and '' != introduction">
                #{introduction},
            </if>
            <if test="researchAreas != null and '' != researchAreas">
                #{researchAreas},
            </if>
            <if test="unitId != null and '' != unitId">
                #{unitId},
            </if>
            <if test="schoolId != null and '' != schoolId">
                #{schoolId},
            </if>
            <if test="peopleId != null and '' != peopleId">
                #{peopleId},
            </if>
            <if test="time != null">
                #{time},
            </if>
            <if test="version != null and '' != version">
                #{version},
            </if>
        </trim>
    </insert>
    <!-- 修改  -->
    <update id="updateInitInfo" >
        UPDATE graduation_ui.basic_info
        <trim prefix="SET" suffixOverrides=",">
            <if test="id != null and '' != id">
                ID= #{id},
            </if>
            <if test="name != null and '' != name">
                NAME= #{name},
            </if>
            <if test="nickName != null and '' != nickName">
                NICK_NAME= #{nickName},
            </if>
            <if test="sex != null and '' != sex">
                SEX= #{sex},
            </if>
            <if test="birthday != null">
                BIRTHDAY= #{birthday},
            </if>
            <if test="politicalStatus != null and '' != politicalStatus">
                POLITICAL_STATUS= #{politicalStatus},
            </if>
            <if test="age != null and '' != age">
                AGE= #{age},
            </if>
            <if test="hometown != null and '' != hometown">
                HOMETOWN= #{hometown},
            </if>
            <if test="avatarUrl != null and '' != avatarUrl">
                AVATAR_URL= #{avatarUrl},
            </if>
            <if test="phone != null and '' != phone">
                PHONE= #{phone},
            </if>
            <if test="fax != null and '' != fax">
                FAX= #{fax},
            </if>
            <if test="email != null and '' != email">
                EMAIL= #{email},
            </if>
            <if test="qq != null and '' != qq">
                QQ= #{qq},
            </if>
            <if test="wechat != null and '' != wechat">
                WECHAT= #{wechat},
            </if>
            <if test="blog != null and '' != blog">
                BLOG= #{blog},
            </if>
            <if test="postCode != null and '' != postCode">
                POST_CODE= #{postCode},
            </if>
            <if test="address != null and '' != address">
                ADDRESS= #{address},
            </if>
            <if test="department != null and '' != department">
                DEPARTMENT= #{department},
            </if>
            <if test="degree != null and '' != degree">
                DEGREE= #{degree},
            </if>
            <if test="subject != null and '' != subject">
                SUBJECT= #{subject},
            </if>
            <if test="position != null and '' != position">
                POSITION= #{position},
            </if>
            <if test="jobTitle != null and '' != jobTitle">
                JOB_TITLE= #{jobTitle},
            </if>
            <if test="introduction != null and '' != introduction">
                INTRODUCTION= #{introduction},
            </if>
            <if test="researchAreas != null and '' != researchAreas">
                RESEARCH_AREAS= #{researchAreas},
            </if>
            <if test="unitId != null and '' != unitId">
                UNIT_ID= #{unitId},
            </if>
            <if test="schoolId != null and '' != schoolId">
                SCHOOL_ID= #{schoolId},
            </if>
            <if test="peopleId != null and '' != peopleId">
                PEOPLE_ID= #{peopleId},
            </if>
            <if test="time != null">
                TIME= #{time},
            </if>
            <if test="version != null and '' != version">
                VERSION= #{version},
            </if>
        </trim>
        where id= #{id}
    </update>


    <!--通过用户id 查询初始化信息-->
    <select id="queryInitInfo" resultMap="InitInfoMap">
        SELECT
            BI.ID,
            BI.NAME,
            BI.NICK_NAME,
            BI.AVATAT_URL,
            BI.BLOG,
            S.ICON,
            S.NAME AS school
        FROM
            graduation_ui.basic_info AS BI
            LEFT JOIN graduation_ui.school AS S
            ON BI.SCHOOL_ID = S.CODE
        WHERE
            PEOPLE_ID = #{id} AND bi.VERSION = 0
        order by TIME desc
    </select>

    <insert id="easyPoiExcelImport">
        INSERT INTO graduation_ui.basic_info (ID,NAME,NICK_NAME,SEX,BIRTHDAY,POLITICAL_STATUS,AGE,HOMETOWN,AVATAT_URL,PHONE,FAX,EMAIL,QQ,WECHAT,BLOG,POST_CODE,ADDRESS,DEPARTMENT,DEGREE,SUBJECT,POSITION,JOB_TITLE,INTRODUCTION,RESEARCH_AREAS,UNIT_ID,SCHOOL_ID,PEOPLE_ID)
        VALUES
        <foreach collection="list" item="basicInfo" separator=",">
            (#{basicInfo.id},#{basicInfo.name},#{basicInfo.nickName},#{basicInfo.sex},#{basicInfo.birthday},#{basicInfo.politicalStatus},
            #{basicInfo.age},#{basicInfo.hometown},#{basicInfo.avatatUrl},#{basicInfo.phone},#{basicInfo.fax},#{basicInfo.email},
            #{basicInfo.qq},#{basicInfo.wechat},#{basicInfo.blog},#{basicInfo.postCode},#{basicInfo.address},#{basicInfo.department},
            #{basicInfo.degree},#{basicInfo.subject},#{basicInfo.position},#{basicInfo.jobTitle},#{basicInfo.introduction},#{basicInfo.researchAreas},
            #{basicInfo.unitId},#{basicInfo.schoolId},#{basicInfo.peopleId})
        </foreach>
    </insert>

    <!--头像更新-->
    <insert id="updateAvatar">
        UPDATE graduation_ui.basic_info
        SET AVATAT_URL = #{avatar}
        WHERE
            ID = #{id}
    </insert>

    <!-- -&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;-->
    <!--查询学校信息-->
    <select id="schoolInfo" resultMap="SchoolMap">
        SELECT
            s.`NAME`,
            s.ADDRESS,
            s.`CODE`,
            s.ICON
        FROM
            graduation_ui.school AS s
                LEFT JOIN basic_info AS bi ON s.`CODE` = bi.SCHOOL_ID
        WHERE
            bi.PEOPLE_ID = #{id} AND bi.VERSION = 0
    </select>

    <!--通过用户id 查询-->
    <select id="queryUserBaseInfo" resultMap="BasicInfoMap">
        select
            ID, NAME, NICK_NAME, SEX, BIRTHDAY, AGE, HOMETOWN, AVATAT_URL, PHONE, EMAIL, QQ, WECHAT, BLOG, ADDRESS, DEGREE, SUBJECT, POSITION, JOB_TITLE
        from graduation_ui.basic_info
        where PEOPLE_ID = #{id} AND VERSION = 0
    </select>

</mapper>